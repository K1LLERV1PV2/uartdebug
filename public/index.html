<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#2c3e50" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>UART Terminal - Uart Debug</title>
    <link rel="manifest" href="/manifest.webmanifest" />
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
    <!-- link to global styles and uart specific styles -->
    <link rel="stylesheet" href="uart.css" />
    <!-- include Chart.js library -->
    <script src="vendor/chart.umd.js"></script>
    <script defer src="uart.js"></script>
  </head>
  <body>
    <main>
      <div class="feature-panel">
        <!-- Web Serial API support warning -->
        <div class="api-support-warning" id="apiWarning">
          <strong>Attention:</strong> Your browser does not support the
          Web&nbsp;Serial API. To work with UART you need a modern browser based
          on Chromium (Chrome, Edge, Opera).
        </div>

        <!-- Connection section -->
        <section class="uart-section">
          <h2 class="status-indicator disconnected" id="statusIndicator">
            Disconnected
          </h2>

          <div class="connection-panel">
            <button class="connect-btn" id="connectBtn">Connect</button>

            <div class="connection-control">
              <label>Baud rate</label>
              <select id="baudRate">
                <option value="9600">9600</option>
                <option value="19200">19200</option>
                <option value="38400">38400</option>
                <option value="57600">57600</option>
                <option value="115200" selected>115200</option>
                <option value="230400">230400</option>
                <option value="460800">460800</option>
                <option value="921600">921600</option>
              </select>
            </div>

            <button
              class="settings-btn"
              id="settingsBtn"
              title="Connection settings"
            >
              <!-- gear icon -->
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97 0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1 0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"
                />
              </svg>
            </button>
            <span class="connection-note">
              Hardware debugging via USB-UART bridge
            </span>
          </div>
        </section>

        <!-- Terminal and oscilloscope section -->
        <div class="uart-sessions-split">
          <section
            class="uart-section uart-session is-locked"
            id="uartTxSession"
            aria-disabled="true"
          >
            <div class="terminal-wrapper">
              <div class="terminal-header">
                <h3 class="terminal-label">TxD</h3>
                <div class="view-toggle">
                  <div class="radio-group">
                    <label class="radio-label-inline">
                      <input type="radio" name="txView" value="text" checked />
                      <span>Text</span>
                    </label>
                    <label class="radio-label-inline">
                      <input type="radio" name="txView" value="generator" />
                      <span>Generator</span>
                    </label>
                  </div>
                </div>
                <div
                  class="mode-controls"
                  id="txModeControls"
                  aria-label="TxD mode"
                >
                  <div class="radio-group">
                    <label class="radio-label-inline">
                      <input type="radio" name="txMode" value="ascii" checked />
                      <span>ASCII</span>
                    </label>
                    <label class="radio-label-inline">
                      <input type="radio" name="txMode" value="hex" />
                      <span>HEX</span>
                    </label>
                  </div>
                </div>
                <div class="log-controls" id="txLogControls">
                  <label class="checkbox-label">
                    <input type="checkbox" id="autoScrollCheckbox" checked />
                    <span class="checkbox-custom"></span>
                    Auto&#8209;scroll
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="timestampCheckbox" />
                    <span class="checkbox-custom"></span>
                    Show time
                  </label>
                </div>
                <div class="run-controls">
                  <label class="checkbox-label">
                    <input type="checkbox" id="cycleCheckbox" />
                    <span class="checkbox-custom"></span>
                    Cycle
                  </label>
                  <div class="cycle-interval">
                    <input
                      type="number"
                      class="loop-interval-input"
                      id="loopIntervalInput"
                      min="10"
                      max="10000"
                      step="10"
                      value="1000"
                      title="Interval in ms"
                    />
                    <span class="loop-interval-label">ms</span>
                  </div>
                  <button class="send-btn" id="sendBtn" disabled>Run</button>
                </div>
              </div>
              <div class="terminal-shell" id="txTerminalShell">
                <div class="terminal-actions" id="terminalActionsTx">
                  <button
                    class="icon-btn"
                    id="clearBtn"
                    title="Clear TxD log"
                    aria-label="Clear TxD log"
                  >
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path
                        d="M9 3h6M5 6h14m-1 0l-1 14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 6m3 4v8m4-8v8"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.6"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </button>
                  <button
                    class="icon-btn"
                    id="saveLogBtn"
                    title="Save TxD log"
                    aria-label="Save TxD log"
                  >
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path
                        d="M12 4v11m0 0l4-4m-4 4l-4-4M5 20h14"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.6"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </button>
                </div>
                <div class="terminal-container" id="terminalSent"></div>
              </div>
              <div
                class="generator-panel"
                id="txGeneratorPanel"
                style="display: none"
              >
                <div class="generator-grid">
                  <div class="generator-field">
                    <label for="genWaveform">Wave</label>
                    <select id="genWaveform">
                      <option value="sine" selected>Sine</option>
                      <option value="triangle">Triangle</option>
                      <option value="square">Square</option>
                    </select>
                  </div>
                  <div class="generator-field">
                    <label for="genSamples">Samples</label>
                    <input
                      type="number"
                      id="genSamples"
                      min="4"
                      max="4096"
                      step="1"
                      value="64"
                    />
                  </div>
                  <div class="generator-field">
                    <label for="genAmplitude">Amplitude</label>
                    <input
                      type="number"
                      id="genAmplitude"
                      step="1"
                      value="100"
                    />
                  </div>
                  <div class="generator-field">
                    <label for="genOffset">Offset</label>
                    <input type="number" id="genOffset" step="1" value="0" />
                  </div>
                  <div class="generator-field" id="genDutyField">
                    <label for="genDuty">Duty %</label>
                    <input
                      type="number"
                      id="genDuty"
                      min="1"
                      max="99"
                      step="1"
                      value="50"
                    />
                  </div>
                </div>
                <div class="generator-options">
                  <div class="radio-group">
                    <label class="radio-label-inline">
                      <input
                        type="radio"
                        name="genSignMode"
                        value="unsigned"
                        checked
                      />
                      <span>Unsigned</span>
                    </label>
                    <label class="radio-label-inline">
                      <input type="radio" name="genSignMode" value="signed" />
                      <span>Signed</span>
                    </label>
                  </div>
                  <div class="radio-group">
                    <label class="radio-label-inline">
                      <input
                        type="radio"
                        name="genByteSize"
                        value="1"
                        checked
                      />
                      <span>1 byte</span>
                    </label>
                    <label class="radio-label-inline">
                      <input type="radio" name="genByteSize" value="2BE" />
                      <span>2 byte (BE)</span>
                    </label>
                    <label class="radio-label-inline">
                      <input type="radio" name="genByteSize" value="2LE" />
                      <span>2 byte (LE)</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div class="terminal-input-panel">
              <input
                type="text"
                class="terminal-input"
                id="terminalInput"
                placeholder="Text string"
                disabled
              />
            </div>
          </section>

          <section
            class="uart-section uart-session is-locked"
            id="uartRxSession"
            aria-disabled="true"
          >
            <div class="terminal-wrapper">
              <div class="terminal-header">
                <h3 class="terminal-label">RxD</h3>
                <div class="view-toggle">
                  <div class="radio-group">
                    <label class="radio-label-inline">
                      <input
                        type="radio"
                        name="rxView"
                        value="terminal"
                        checked
                      />
                      <span>Text</span>
                    </label>
                    <label class="radio-label-inline">
                      <input type="radio" name="rxView" value="oscilloscope" />
                      <span>Graphic</span>
                    </label>
                  </div>
                </div>
                <div class="rx-left-controls">
                  <div class="mode-controls" aria-label="RxD mode">
                    <div class="radio-group">
                      <label class="radio-label-inline">
                        <input
                          type="radio"
                          name="rxMode"
                          value="ascii"
                          checked
                        />
                        <span>ASCII</span>
                      </label>
                      <label class="radio-label-inline">
                        <input type="radio" name="rxMode" value="hex" />
                        <span>HEX</span>
                      </label>
                    </div>
                  </div>
                </div>
                <div
                  class="data-mode-controls"
                  id="dataModeControls"
                  style="display: none"
                >
                  <div class="radio-group">
                    <label class="radio-label-inline">
                      <input
                        type="radio"
                        name="signMode"
                        value="unsigned"
                        checked
                      />
                      <span>Unsigned</span>
                    </label>
                    <label class="radio-label-inline">
                      <input type="radio" name="signMode" value="signed" />
                      <span>Signed</span>
                    </label>
                  </div>

                  <div class="radio-group">
                    <label class="radio-label-inline">
                      <input type="radio" name="byteSize" value="1" checked />
                      <span>1 byte</span>
                    </label>
                    <label class="radio-label-inline">
                      <input type="radio" name="byteSize" value="2BE" />
                      <span>2 byte (BE)</span>
                    </label>
                    <label class="radio-label-inline">
                      <input type="radio" name="byteSize" value="2LE" />
                      <span>2 byte (LE)</span>
                    </label>
                  </div>
                </div>
                <div class="rx-controls-right">
                  <button
                    class="log-btn receive-toggle-btn receiving"
                    id="receiveToggleBtn"
                    title="Stop receiving"
                  >
                    Stop
                  </button>
                </div>
              </div>
              <div class="terminal-shell" id="rxTerminalShell">
                <div class="terminal-actions" id="terminalActionsRx">
                  <button
                    class="icon-btn"
                    id="clearBtnRx"
                    title="Clear RxD log"
                    aria-label="Clear RxD log"
                  >
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path
                        d="M9 3h6M5 6h14m-1 0l-1 14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 6m3 4v8m4-8v8"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.6"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </button>
                  <button
                    class="icon-btn"
                    id="saveLogBtnRx"
                    title="Save RxD log"
                    aria-label="Save RxD log"
                  >
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path
                        d="M12 4v11m0 0l4-4m-4 4l-4-4M5 20h14"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.6"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </button>
                </div>
                <div class="terminal-container" id="terminalReceived"></div>
              </div>
              <div
                class="oscilloscope-container"
                id="oscilloscopeContainer"
                style="display: none"
              >
                <div class="oscilloscope-actions">
                  <div
                    class="oscilloscope-controls"
                    id="oscilloscopeControls"
                    style="display: none"
                  >
                    <button
                      class="icon-btn"
                      id="oscilloFullscreenBtn"
                      title="Fullscreen"
                      aria-label="Fullscreen"
                    >
                      <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path
                          d="M8 4H4v4M16 4h4v4M20 16v4h-4M4 16v4h4"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="1.6"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                      </svg>
                    </button>
                    <button
                      class="icon-btn"
                      id="oscilloResetBtn"
                      title="Reset zoom and pan"
                      aria-label="Reset zoom and pan"
                    >
                      <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path
                          d="M20 12a8 8 0 1 1-2.34-5.66M20 4v6h-6"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="1.6"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                      </svg>
                    </button>
                    <button
                      class="icon-btn"
                      id="oscilloClearBtn"
                      title="Clear graph"
                      aria-label="Clear graph"
                    >
                      <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path
                          d="M9 3h6M5 6h14m-1 0l-1 14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 6m3 4v8m4-8v8"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="1.6"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                      </svg>
                    </button>
                    <button
                      class="icon-btn"
                      id="oscilloDownloadBtn"
                      title="Download graph"
                      aria-label="Download graph"
                    >
                      <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path
                          d="M12 4v11m0 0l4-4m-4 4l-4-4M5 20h14"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="1.6"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                      </svg>
                    </button>
                  </div>
                </div>
                <canvas id="oscilloscopeCanvas"></canvas>
              </div>
            </div>
          </section>
        </div>

        <!-- Modal dialog for connection settings -->
        <div class="modal-overlay" id="settingsModal">
          <div class="modal-content">
            <div class="modal-header">
              <h3>Connection settings</h3>
              <button class="modal-close" id="modalCloseBtn">&times;</button>
            </div>

            <div class="modal-body">
              <div class="connection-control">
                <label>Baud rate</label>
                <select id="modalBaudRate">
                  <option value="9600">9600</option>
                  <option value="19200">19200</option>
                  <option value="38400">38400</option>
                  <option value="57600">57600</option>
                  <option value="115200" selected>115200</option>
                  <option value="230400">230400</option>
                  <option value="460800">460800</option>
                  <option value="921600">921600</option>
                </select>
              </div>
              <div class="connection-control">
                <label>Data bits</label>
                <select id="dataBits">
                  <option value="7">7</option>
                  <option value="8" selected>8</option>
                </select>
              </div>
              <div class="connection-control">
                <label>Stop bits</label>
                <select id="stopBits">
                  <option value="1" selected>1</option>
                  <option value="2">2</option>
                </select>
              </div>
              <div class="connection-control">
                <label>Parity</label>
                <select id="parity">
                  <option value="none" selected>None</option>
                  <option value="even">Even</option>
                  <option value="odd">Odd</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <footer
      style="
        margin: 40px auto;
        max-width: 980px;
        padding: 16px;
        opacity: 0.7;
        text-align: center;
        font:
          14px/1.4 system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Ubuntu,
          Cantarell,
          &quot;Helvetica Neue&quot;,
          Arial,
          &quot;Noto Sans&quot;,
          &quot;Apple Color Emoji&quot;,
          &quot;Segoe UI Emoji&quot;;
      "
    >
      Contact: <a href="mailto:uartdebug@gmail.com">uartdebug@gmail.com</a>
    </footer>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function () {
          navigator.serviceWorker.register("/sw.js").catch(function (error) {
            console.error("Service worker registration failed:", error);
          });
        });
      }
    </script>
  </body>
</html>
